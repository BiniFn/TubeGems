[phases.setup]
nixPkgs = ["python311", "nodejs_20", "npm"]

[phases.install]
# We run the build during the install phase to ensure the 'dist' folder is present 
# in the final image layer alongside dependencies.
cmds = ["npm install", "npm run build", "pip install -r requirements.txt"]

[phases.build]
# Build is handled in install phase to guarantee persistence
cmds = ["echo 'Build completed in install phase'"]

[start]
cmd = "gunicorn main:app"
